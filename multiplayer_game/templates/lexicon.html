<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GestureFlow - The Showdown (Split Screen)</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400&display=swap"
        rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        :root {
            --primary-glow: #4ade80; /* Green */
            --secondary-glow: #31c3cd; /* Cyan */
            --dark-bg: #0d1117;
            --card-bg: rgba(22, 27, 34, 0.7);
            --border-color: rgba(68, 76, 88, 0.7);
        }
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--dark-bg);
            color: #e2e8f0;
            overflow-x: hidden;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background:
                linear-gradient(to right, rgba(255, 255, 255, 0.02) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
            background-size: 30px 30px;
            opacity: 0.8;
            z-index: -1;
        }
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        .card {
            background-color: var(--card-bg);
            backdrop-filter: blur(10px);
            border: 2px solid var(--border-color);
            transition: all 0.3s ease-in-out;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        .card:hover {
            border-color: var(--secondary-glow);
            box-shadow: 0 0 25px var(--secondary-glow);
            transform: scale(1.02);
        }
        .glow-text {
            text-shadow: 0 0 5px var(--primary-glow), 0 0 15px var(--primary-glow), 0 0 30px var(--primary-glow);
        }
    </style>
</head>

<body class="text-white">

    <video id="webcam-source" autoplay playsinline muted style="display: none;"></video>

    <header class="fixed top-0 left-0 right-0 z-50 py-4 px-8 bg-[rgba(13,17,23,0.8)] backdrop-blur-sm shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <a href="#" class="font-orbitron text-2xl font-bold text-sky-400">GestureFlow</a>
            <nav>
                <ul class="flex space-x-8">
                    <li><a href="#" class="font-orbitron text-lg text-gray-300 hover:text-white">HOME</a></li>
                    <li><a href="#" class="font-orbitron text-lg text-gray-300 hover:text-white">ABOUT US</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="min-h-screen flex flex-col items-center justify-center p-4 pt-24">
        <section class="max-w-6xl mx-auto text-center mb-10">
            <h1 class="font-orbitron text-5xl md:text-7xl font-bold mb-4 glow-text">Lexicon</h1>
            <p class="text-xl md:text-2xl text-sky-300 tracking-wide">Player vs. Player: Race to sign the word!</p>
        </section>

        <main class="w-full max-w-7xl mx-auto flex flex-col md:flex-row justify-center items-center gap-8 mb-10">
            <div class="flex flex-col items-center w-full md:w-1/2">
                <h2 class="font-orbitron text-3xl md:text-4xl text-sky-400 mb-4 text-center">Player 1 (Left)</h2>
                <div class="card relative overflow-hidden aspect-video rounded-xl w-full">
                    <canvas id="player1-canvas"
                        class="absolute top-0 left-0 w-full h-full object-cover transform scale-x-[-1]"></canvas>
                </div>
            </div>

            <div class="flex flex-col items-center w-full md:w-1/2">
                <h2 class="font-orbitron text-3xl md:text-4xl text-sky-400 mb-4 text-center">Player 2 (Right)</h2>
                <div class="card relative overflow-hidden aspect-video rounded-xl w-full">
                    <canvas id="player2-canvas"
                        class="absolute top-0 left-0 w-full h-full object-cover transform scale-x-[-1]"></canvas>
                </div>
            </div>
        </main>

        <section class="max-w-3xl mx-auto text-center p-8">
            <div class="flex items-center justify-center gap-6 mb-8">
                <div class="bg-gray-800/50 backdrop-blur-sm p-4 rounded-xl border border-gray-700">
                    <h3 class="font-orbitron text-2xl md:text-3xl text-gray-300 mb-2">TIME LEFT</h3>
                    <div id="timer" class="font-orbitron text-6xl md:text-7xl font-bold text-green-400 glow-text">30</div>
                </div>
                <div class="bg-gray-800/50 backdrop-blur-sm p-4 rounded-xl border border-gray-700">
                    <h3 class="font-orbitron text-2xl md:text-3xl text-gray-300 mb-2">GESTURE THIS</h3>
                    <div id="word-display" class="font-orbitron text-6xl md:text-7xl font-bold text-sky-400">START</div>
                </div>
            </div>

            <button id="start-button"
                class="font-orbitron text-xl md:text-2xl bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-10 rounded-full uppercase">
                Start Game
            </button>
        </section>

        <footer class="mt-20 py-8 text-gray-500 w-full border-t border-gray-700/50 text-center">
            <p class="text-lg">&copy; 2025 GestureFlow. All rights reserved.</p>
        </footer>
    </div>
    <script>
        // --- Get all our HTML elements ---
        const sourceVideo = document.getElementById('webcam-source');
        const player1Canvas = document.getElementById('player1-canvas');
        const player2Canvas = document.getElementById('player2-canvas');
        const player1Ctx = player1Canvas.getContext('2d');
        const player2Ctx = player2Canvas.getContext('2d');
        
        const startButton = document.getElementById('start-button');
        const timerDisplay = document.getElementById('timer');
        const wordDisplay = document.getElementById('word-display');

        // --- Game variables ---
        const WORDS = ["HELLO", "GOODBYE", "THANKS", "YES", "NO"];
        const GAME_DURATION = 30;
        let timerInterval = null; // UPDATED: Initialize to null to track game state
        let videoStream;

        function drawSplitScreen() {
            if (sourceVideo.paused || sourceVideo.ended) return;

            const halfWidth = sourceVideo.videoWidth / 2;
            const height = sourceVideo.videoHeight;

            if (player1Canvas.width !== halfWidth) {
                player1Canvas.width = halfWidth;
                player1Canvas.height = height;
                player2Canvas.width = halfWidth;
                player2Canvas.height = height;
            }

            // UPDATED: Swapped the drawing logic
            // Draw the RIGHT half of the video to Player 1's canvas
            player1Ctx.drawImage(sourceVideo, halfWidth, 0, halfWidth, height, 0, 0, halfWidth, height);

            // Draw the LEFT half of the video to Player 2's canvas
            player2Ctx.drawImage(sourceVideo, 0, 0, halfWidth, height, 0, 0, halfWidth, height);

            requestAnimationFrame(drawSplitScreen);
        }

        async function initWebcam() {
            try {
                videoStream = await navigator.mediaDevices.getUserMedia({ video: true });
                sourceVideo.srcObject = videoStream;
                
                sourceVideo.onloadedmetadata = () => {
                    sourceVideo.play();
                    requestAnimationFrame(drawSplitScreen);
                };

            } catch (err) {
                console.error("Error accessing the webcam: ", err);
                alert("Could not start webcam. Please ensure your camera is connected and you grant browser permissions.");
            }
        }

        // UPDATED: Button text and state changes
        function startGame() {
            if (!videoStream) {
                alert("Webcam is not available. Cannot start the game.");
                return;
            }

            // Change button to a "Stop" button
            startButton.textContent = "Stop Game";
            startButton.classList.remove('bg-green-500', 'hover:bg-green-600');
            startButton.classList.add('bg-red-500', 'hover:bg-red-600');

            let timeLeft = GAME_DURATION;
            timerDisplay.textContent = timeLeft;
            wordDisplay.textContent = WORDS[Math.floor(Math.random() * WORDS.length)];

            timerInterval = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = timeLeft;
                if (timeLeft <= 0) {
                    endGame("Time's Up!");
                }
            }, 1000);
        }

        // UPDATED: Button text and state changes
        function endGame(message) {
            clearInterval(timerInterval);
            timerInterval = null; // Reset state to indicate game is stopped

            // Change button back to a "Start" button
            startButton.textContent = "Start Game";
            startButton.classList.remove('bg-red-500', 'hover:bg-red-600');
            startButton.classList.add('bg-green-500', 'hover:bg-green-600');
            
            wordDisplay.textContent = message;
        }

        // NEW: A single handler for the game button
        function handleGameButtonClick() {
            // If the timerInterval is not null, the game is running
            if (timerInterval) {
                endGame("Game Stopped");
            } else {
                startGame();
            }
        }

        // --- Event Listeners ---
        // UPDATED: The button now calls the new handler function
        startButton.addEventListener('click', handleGameButtonClick);
        window.addEventListener('load', initWebcam);
    </script>
</body>

</html>